<!DOCTYPE html>

<head xmlns="http://www.w3.org/1999/html">
    <meta charset='utf8' />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="style/home.css">
    <link rel="stylesheet" type="text/css" href="style/map.css">
    <link rel="stylesheet" type="text/css" href="style/responsive.css">
    <script src="libraries/GSAP/gsap.min.js"></script>
    <script src="libraries/GSAP/Draggable.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <link rel="stylesheet" href="assets/fontawesome/css/all.css">
</head>

<body>
    <div class="login-status">
        <check if="{{ @SESSION.username=='UNSET' }}">
            <true>
                <p>login to write notes</p>
            </true>
            <false>
                <p id="edit-map-text">logged in as {{@SESSION.username}}</p>
            </false>
        </check>
    </div>
    <div class="navbar-layout">
        <div class="navbar-container" style="height:100vh; pointer-events: all;">
            <div class="navbar">
                <div class="navbar-section">
                    <a href="{{ @BASE }}/"><img class="logo" src="img/icons/Mini_Logo.png"></a>
                </div>
                <div class="navbar-section">
                    <ul>
                        <li><a><img class="logo" src="img/icons/WriteNote_Icon.svg" onclick="enterEditMode()"></a>
                        </li>
                        <span></span>
                        <li id="filter-toggle"><a><img class="logo" src="img/icons/Filter_Icon.svg"></a></li>
                    </ul>
                </div>
                <div class="navbar-section">
                    <ul>
                        <li><a href="{{ @BASE }}/"><img class="logo" src="img/icons/Home_Icon.svg"></a></li>
                        <span></span>
                        <li>
                            <check if="{{ @SESSION.username=='UNSET' }}">
                                <false>
                                    <a href="{{@BASE}}/acc"><img src="img/icons/Account_Icon.svg" class="logo"></a>
                                </false>
                                <true>
                                    <a href="{{ @BASE }}/login"><img src="img/icons/Account_Icon.svg" class="logo"></a>
                                </true>
                            </check>
                        </li>
                    </ul>
                </div>
                <div class="navbar-section">
                    <ul>
                        <li><img id="show-tutorial-button" class="logo" src="img/icons/Info_Icon.svg"></li>
                        <span></span>
                        <li><a><img onclick="openReportProblem()" class="logo" src="img/icons/Warning_Icon.svg"></a>
                        </li>
                    </ul>
                </div>
                <div class="search-container" style="align-self: flex-start">
                    <div class="navbar-section search">
                        <img class="logo" src="img/icons/Search_Icon.svg">
                        <input class="location-input" type="text" onkeyup="showHint(this.value)"
                            placeholder="Search Location">
                    </div>
                    <div id="search-results">
                        <ul id="textHint" style="padding: 16px"></ul>
                    </div>
                </div>
            </div>
        </div>

        <div class="navbar-container" style="height:100vh">
            <div class="navbar" style="align-items: flex-start; gap:16px">
                <div class="info-section">
                    <div class="info">
                        <div class="info-container">
                            <div class="info-text">
                                <p style="font-weight: bold">Welcome to Thirdplace!</p>
                            </div>
                            <div class="info-close">
                                <img src="img/icons/Close-icon.svg" class="skip" alt="Skip">
                            </div>
                        </div>
                        <div class="info-button">
                            <div class="next"></div>
                        </div>
                    </div>
                </div>
                <div class="info-section">
                    <ul>
                        <div class="info">
                            <div class="info-container">
                                <div class="info-text">
                                    <p>Click here to add your note
                                        in a custom location anywhere on
                                        the map.</p>
                                </div>
                                <div class="info-close">
                                    <img src="img/icons/Close-icon.svg" class="skip" alt="Skip">
                                </div>
                            </div>
                            <div class="info-button">
                                <div class="back"></div>
                                <div class="next"></div>
                            </div>
                        </div>

                        <div class="info">
                            <div class="info-container">
                                <div class="info-text">
                                    <p>Filter the locations on the map</p>
                                </div>
                                <div class="info-close">
                                    <img src="img/icons/Close-icon.svg" class="skip" alt="Skip">
                                </div>
                            </div>
                            <div class="info-button">
                                <div class="back"></div>
                                <div class="next"></div>
                            </div>
                        </div>

                        <div class="info">
                            <div class="info-container">
                                <div class="info-text">
                                    <p>Click here to return to the homepage</p>
                                </div>
                                <div class="info-close">
                                    <img src="img/icons/Close-icon.svg" class="skip" alt="Skip">
                                </div>
                            </div>
                            <div class="info-button">
                                <div class="back"></div>
                                <div class="next"></div>
                            </div>
                        </div>
                    </ul>
                </div>

                <div class="info-section">
                    <div class="info">
                        <div class="info-container">
                            <div class="info-text">
                                <p>Access your account settings</p>
                            </div>
                            <div class="info-close">
                                <img src="img/icons/Close-icon.svg" class="skip" alt="Skip">
                            </div>
                        </div>
                        <div class="info-button">
                            <div class="back"></div>
                            <div class="next"></div>
                        </div>
                    </div>
                </div>

                <div class="info-section">
                    <ul id="filters-on">
                        <div class="info">
                            <div class="info-container">
                                <div class="info-text">
                                    <p>You can re-take the tutorial
                                        at any time by clicking the (i) icon here.</p>
                                </div>
                                <div class="info-close">
                                    <img src="img/icons/Close-icon.svg" class="skip" alt="Skip">
                                </div>
                            </div>
                            <div class="info-button">
                                <div class="back"></div>
                                <div class="next"></div>
                            </div>
                        </div>

                        <div class="info">
                            <div class="info-container">
                                <div class="info-text">
                                    <p>Report a problem</p>
                                </div>
                                <div class="info-close">
                                    <img src="img/icons/Close-icon.svg" class="skip" alt="Skip">
                                </div>
                            </div>
                            <div class="info-button">
                                <div class="back"></div>
                                <div class="next"></div>
                            </div>
                        </div>
                    </ul>

                    <div class="filters" id="filters">
                        <label style="display: flex; align-items: center; gap: 6px;">
                            <input type="checkbox" value="park" class="filter">park
                        </label>
                        <label style="display: flex; align-items: center; gap: 6px;">
                            <input type="checkbox" value="restaurant" class="filter">restaurant
                        </label>
                        <label style="display: flex; align-items: center; gap: 6px;">
                            <input type="checkbox" value="museum" class="filter">museum
                        </label>
                        <label style="display: flex; align-items: center; gap: 6px;">
                            <input type="checkbox" value="cafe" class="filter">cafe
                        </label>
                        <label style="display: flex; align-items: center; gap: 6px;">
                            <input type="checkbox" value="bar" class="filter">bar
                        </label>
                        <label style="display: flex; align-items: center; gap: 6px;">
                            <input type="checkbox" value="landmark" class="filter">landmark
                        </label>
                        <label style="display: flex; align-items: center; gap: 6px;">
                            <input type="checkbox" value="street" class="filter">street
                        </label>
                        <label style="display: flex; align-items: center; gap: 6px;">
                            <input type="checkbox" value="other" class="filter">other
                        </label>
                    </div>
                </div>
                <div class="info-section" style="align-self: flex-start">
                    <div class="info">
                        <div class="info-container">
                            <div class="info-text">
                                <p>Search our database of popular
                                    locations in your city here.</p>
                            </div>
                            <div class="info-close">
                                <img src="img/icons/Close-icon.svg" class="skip" alt="Skip">
                            </div>
                        </div>
                        <div class="info-button">
                            <div class="back"></div>
                            <div class="next"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </div>
    <div id="map-container">
        <div class="map" id="map">
            <div class="zoom-overlay" id="overlay1"></div>
            <div class="zoom-overlay" id="overlay2"></div>
            <div class="zoom-overlay" id="overlay3"></div>
            <div class="pin-parent">
                <repeat group="{{ @thirdplacesData }}" value="{{ @place }}">
                    <div class="pin {{@place.type}}"
                        style="left: {{ @place.position_x - 10 }}px; top: {{ @place.position_y - 15 }}px;"
                        onclick="openModal('{{@place.name}}')">
                        <!--                add amount of notes in a place-->
                        <p class="pin-number">{{@place.note_count}}</p>
                    </div>
                </repeat>
            </div>
        </div>
    </div>

    <div class="modal" id="modal-notes">
        <div class="modal-header">
            <h3 id="modal-note-thirdplace-name">Placeholder</h3>
            <img src="img/icons/Close-icon.svg" class="close-btn" onclick="closeModal()">
        </div>
        <div class="modal-content">
            <button class="floating-btn" onclick="openWriteNoteModal()">Leave a note</button>
            <div class="notes-container">
            </div>
        </div>
    </div>

    <div class="modal" id="modal">
        <div class="modal-header">
            <h3 id="modal-thirdplace-name">Placeholder</h3>
            <img src="img/icons/Close-icon.svg" class="close-btn" onclick="closeModal()">
        </div>
        <div class="modal-content">
            <check if="{{@SESSION.username!= 'UNSET'}}">
                <true>
                    <form id="notes" name="notes" method="post" action="{{@BASE}}/submitReason">
                        <textarea class="input" id="reason" name="reason" style="resize:none"
                            placeholder="Write your reason here..." required maxlength="220"></textarea>
                        <div style="margin: 16px 0; display: flex; align-items: center;">
                            <label for="stay-anon-check">Stay Anonymous</label>
                            <input type="checkbox" class="check" id="stay-anon-check" name="isAnonymous" value="1">
                        </div>
                        <input type="hidden" id="thirdplace_name" name="thirdplace">
                        <button type="submit" class="floating-btn-2" value="reason">Submit</button>
                        <p class="errorNote"> {{ @error }} </p>
                    </form>
                </true>
                <false>
                    <p>Log in to leave a note</p>
                </false>
            </check>
        </div>
    </div>

    <div class="modal" id="modal-location">
        <div class="modal-header">
            <p style="font-size: 24px">Add Note</p>
            <img src="img/icons/Close-icon.svg" class="close-btn" onclick="closeModal()">
        </div>
        <check if="{{ @SESSION.username=='UNSET' }}">
            <false>
                <form name="notes" id="new-location-notes" method="post" action="{{@BASE}}/submitReasonAndLocation"
                    >

                    <div class="modal-content-note">
                        <p style="font-size: 18px">logged in as {{@SESSION.username}}</p>
                        <div class="modal-add-note">
                            <div class="modal-addnote-username">
                                <p style="font-weight: bold">{{ @SESSION.username }}</p>
                            </div>
                            <div style="margin: 16px 0; display: flex; align-items: center;">
                                <label for="stay-anon-check-2">Stay Anonymous</label>
                                <input type="checkbox" class="check" id="stay-anon-check-2" name="isAnonymous"
                                    value="1">
                            </div>
                            <div class="modal-input-wrapper">
                                <textarea type="text" placeholder="Write your reason here..." name="reason"
                                    class="input" required maxlength="220" style="height: 100px"></textarea>
                            </div>
                            <div class="modal-input-location">
                                <input type="text" name="thirdplace" placeholder="Enter the location name..."
                                    class="input location-input-modal" onkeyup="showHintModal(this.value)" required>
                                <div class="search-results-modal">
                                    <ul id="text-hint-modal">
                                    </ul>
                                </div>
                            </div>
                            <p class="new-location-message" style="display: none">Your location will be added to the database. Please choose a type</p>
                            <input type="hidden" id="x-coord" name="position_x">
                            <input type="hidden" id="y-coord" name="position_y">
                            <div class="place-type" style="display: none">
                                <select name="thirdplace_type" class="select-place-type" style="background-color: white;" required>
                                    <option value="" selected disabled>Select an option...</option>
                                    <option value="park">Park</option>
                                    <option value="restaurant">Restaurant</option>
                                    <option value="museum">Museum</option>
                                    <option value="cafe">Cafe</option>
                                    <option value="bar">Bar</option>
                                    <option value="landmark">Landmark</option>
                                    <option value="street">Street</option>
                                    <option value="other">Other</option>
                                </select>
                            </div>
                        </div>
                        <button type="submit" class="floating-btn-2" value="reason">Submit</button>
                    </div>
                </form>
            </false>
            <true>
                <p style="top: 100px;position: fixed;">Login to leave a note</p>
            </true>
        </check>
    </div>

    <div class="modal" id="report-problem">
        <div class="modal-header">
            <div>
                <h3>Something wrong?</h3>
                <p>Let us know the problem and we will try to sort it out.</p>
            </div>
            <img src="img/icons/Close-icon.svg" class="close-btn" onclick="closeReportProblem()">
        </div>
        <form style="padding: 16px 0" method="post" class="modal-content" action="{{@BASE}}/reportAProblem"
            id="report-problem-form">
            <label for="report-message"></label>
            <div class="modal-input-wrapper">
                <textarea id="report-message" class="input" name="content" required></textarea>
            </div>
            <button type="submit" class="submit-btn">Submit</button>
        </form>
    </div>

    <div id="popup" class="popup">
        <div class="popup-content">
            <p id="popup-message"></p>
            <div class="popup-closediv">
                <div id="popup-close" class="popup-closebtn" tabindex="0">&times;</div>
            </div>
        </div>
    </div>

    <div class="overlay">
    </div>
</body>
<script src="javascript/map.js"></script>
<script src="javascript/map-nav.js"></script>
<script src="javascript/map-controls.js"></script>

</html>